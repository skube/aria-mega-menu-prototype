<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>Prototype II</title>
	<base href="http://gm.ca">
<style>

	button {cursor: pointer}
	.wrap {width: 990px; margin: 0 auto;}

	*[role=navigation] *[aria-hidden=true] {display: none}

	.a-dnav {
		position: relative;
		margin: 0;
		padding: 0;
		list-style: none;
		border: 1px solid black;
		background: white;
	}
	.a-dnav > li,
	.a-dnav [role=menu] > li,
	.a-dnav [role=menu] > dt,
	.a-dnav [role=menu] > dd
	 {
		float: left;
		margin: 0;
		padding: .25em .35em;
		list-style: none;
	}
	.a-dnav > li:after {content: "\2f"; color:red;}

	.a-dnav__cars,
	.a-dnav__trucks
	 {
	 	position: absolute;
	 	left: 0;
	 }

	 .a-dnav__models {
	 	top: 2em;
	 }

	.a-dnav [role=menu] {
		position: absolute;
		left: 0;
		width: 990px;
		margin: 0;
		padding: 0;
		background: #8EBBB4;
	}
	.a-dnav .a-dnav__upcoming {
		top:0.25em;
	}
	
	.a-dnav__content {
		position: absolute;
		left:0;
		width: 990px;
		background: #ccc;
	}

	.a-dnav__vert[role=menu] {
		left:auto;
		width: 176px;
		background: #ccc;
	}
	.a-dnav__vert[role=menu] li {
		float: none;
	}

	*[aria-checked="true"]	{
		background: yellow;
	}

	
	.clearfix:before,
	.clearfix:after {
		content: " ";
		display: table;
	}
	.clearfix:after {
		clear: both;
	}


</style>

</head>
<body>
<!-- 
- aria-describedby: reads description after (description provides more information that the user might need)
- aria-labelledby: reads label before (label describes the essence of an object)
- aria-label: reads label before
- aria-owns: Defines an object as a parent of another document element, when the child does not appear directly in the subtree of the owner
- aria-flowto="trucksbtn" (try it?)
- TODO: create nomenclature to handle unique IDs
-->
<div class="wrap">

	<div role="navigation">
		
		<ul role="menubar" id="accessible-div-nav" class="a-dnav clearfix">
			<li role="presentation">

				<button type="button" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" id="carsbtn" aria-owns="cars">CARS</button>

				<div id="a-dnav__cars" role="group" aria-hidden="true" class="a-dnav__cars">
					
					<dl role="menu" class="a-dnav__upcoming">
						<dt role="presentation" id="a-dnav__cars--up-title">Upcoming vehicles</dt>
						<dd role="presentation" aria-label="Upcoming vehicles"><a role="menuitem" href="#">2014 Camaro</a></dd>
						<dd role="presentation" aria-describedby="a-dnav__cars--up-title"><a role="menuitem" href="#">2014 Colorado</a></dd>
						<dd role="presentation" aria-describedby="a-dnav__cars--up-title"><a role="menuitem" href="#">2014 Colorado</a></dd>
					</dl>

					<ul role="menu" class="a-dnav__models">

						<li role="presentation" id="a-dnav__cars--mdl01">

							<button type="button" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="veh01_car_trims">
								<img src="/images/divisional/chevrolet/vehicles/divnav_thumb_chev_spar_on.jpg" alt="">
								<h4>Spark</h4>
								<p>from $29,000</p>
							</button>

							<dl role="menu" id="veh01_car_trims" aria-hidden="true" class="a-dnav__trims">
								<dt role="presentation" id="car_trims_desc_01">Select a Model</dt>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="a-dnav__mdl01_t01--content">Trim 1</button>

									<div id="a-dnav__mdl01_t01--content" class="a-dnav__content" aria-hidden="true" tabindex="-1">

										<div class="trim_2014_chev_trax">

										<div class="vehicleNameContainer">2014 Trax </div>
										
											<div class="learnMore">
												<div class="lm">
													<a href="/gm/english/vehicles/chevrolet/trax/overview">Learn More</a>
												</div>
											</div>
										
											<div class="msrp">MSRP From $18,695 <sup>Ω</sup></div>
										
											<p class="pc">Enter your postal code to see local offers: 
												<span class="basePC">POSTAL CODE</span> (<a class="changePC" href="#">Change</a>)
											</p>
											<form>
												<p class="pcSubmit">Enter your postal code to see local offers: 
													<input type="text" name="flyout-pc" class="flyout-pc" maxlength="7"> 
													(<a href="#" class="submitPC">Submit</a>)
												</p>
											</form>						
																								
											<p class="infoTxt">Trax is the right-sized crossover that delivers the manoeuvrability you need for city streets, combined with an unsurpassed highway fuel efficiency rating of just 5.7 L/100 km.<sup>1</sup> Take to the streets – and roads – with confidence in the 2014 Chevrolet Trax.</p>
																
											<div class="hockeyCard">
												<a href="/gm/english/vehicles/chevrolet/trax/overview"><img src="/images/divisional/chevrolet/vehicles/chev_trax_hockey_card.jpg" alt="" title=""></a>
											</div>																	
														
											<!-- specs  start-->
											<div class="specsBoxes">
												<div class="specBox">
													<div class="specBox-fuel-efficiency">
														<div class="title">Fuel Efficiency</div>
														<div class="fuel-efficiency"></div>
														<div class="amt">5.7
															<div class="feature">L/100km hwy<sup>1</sup></div>
														</div>
													</div>
												</div>
												<div class="specBox">
													<div class="specBox-interior-volume">
														<div class="title">Cargo Volume</div>
														<div class="interior-volume"></div>
														<div class="amt">1,371
															<div class="feature">L (48.4 cu. ft.)</div>
														</div>
													</div>
												</div>
												<div class="specBox">
													<div class="specBox-turbo-engine">
														<div class="title">Standard</div>
														<div class="turbo-engine"></div>
														<div class="amt">Turbo
															<div class="feature">engine</div>
														</div>
													</div>
												</div>
											</div>
											<!-- specs  end-->

									</div>

								</div>									
								</dd>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="a-dnav__mdl01_t02--content">Trim 2</button>

									<div id="a-dnav__mdl01_t02--content" aria-hidden="true" class="a-dnav__content" tabindex="-1">
										<p>Trim2 Content</p>
										<input type="text" />
										<button type="button">choose</button>
									</div>

								</dd>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="a-dnav__mdl01_t03--content">Trim 3</button>

									<div id="a-dnav__mdl01_t03--content" aria-hidden="true" class="a-dnav__content" tabindex="-1">
										<p>Trim3 Content</p>
										<input type="text" />
										<button type="button">choose</button>
									</div>

								</dd>
							</dl>
						</li>

						<li role="presentation" id="a-dnav__cars--mdl02">
							<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" id="sonicBtn" aria-owns="veh02_content">
								<img src="/images/divisional/chevrolet/vehicles/divnav_thumb_chev_soni_on.jpg" alt="">
								<h4>Sonic</h4>
								<p>from $29,000</p>
							</button>

							<div id="a-dnav__mdl02--content" class="a-dnav__content" aria-hidden="true" tabindex="-1">

								<p>something</p>
								<input type="text" />
								<button type="button">choose</button>

							</div>

						</li>

					</ul>

				</div>

			</li>
			<li role="presentation">

				<button type="button" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" id="trucksbtn" aria-owns="a-dnav__trucks" aria-controls="a-dnav__trucks">Trucks</button>

				<div id="a-dnav__trucks" role="group" aria-hidden="true" class="a-dnav__trucks">

					<dl role="menu" class="a-dnav__upcoming">
						<dt role="presentation" id="a-dnav__trucks--up-title">Upcoming vehicles</dt>
						<dd role="presentation" aria-label="Upcoming vehicles"><a role="menuitem" href="#">2014 Truck1</a></dd>
						<dd role="presentation" aria-describedby="a-dnav__trucks--up-title"><a role="menuitem" href="#">2014 Truck2</a></dd>
						<dd role="presentation" aria-describedby="a-dnav__trucks--up-title"><a role="menuitem" href="#">2014 Truck3</a></dd>
					</dl>

	
				</div>


			</li>

			<!-- Vertical Menus -->
			<li role="presentation">

				<button type="button" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="a-dnav__vert01">Highlights</button>

				<ul role="menu" id="a-dnav__vert01" aria-hidden="true" class="a-dnav__vert">
					<li class="menu-item">
						<a href="#" role="menuitem">lorem</a>
					</li>
					<li class="menu-item">
						<a href="#" role="menuitem">lorem</a>
					</li>
					<li class="menu-item">
						<a href="#" role="menuitem">lorem</a>
					</li>
				</ul>

			</li>
		</ul>

	</div>

	<div role="main">
		<h1>header</h1>
		<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illo, repellat, officia natus id cupiditate molestiae laborum ab in aperiam voluptate necessitatibus eaque minus. Ducimus, voluptates autem ullam reprehenderit assumenda cum!</p>
		<input type="text">something</input>
	</div>

</div>

<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		var menu1 = new Menubar('accessible-div-nav');
	}); // end ready()

	function Menubar (id) {

		// define widget properties
		this.$id = $('#' + id);

		this.$rootItems = this.$id.children('li'); // root-level menu items

		this.$items = this.$id.find('[role=menuitem]').add('.a-dnav__content');  // menu items (buttons or anchors)
		this.$parents = this.$id.find('[role=menu]');    // container (dl or ul)
		this.$allItems = this.$parents.add(this.$items); // 
		this.$activeItem = null; // jQuery object of the menu item with focus

		this.keys = {
			TAB:    9,
			ENTER:  13,
			ESC:    27,
			SPACE:  32,
			LEFT:   37,
			UP:     38,
			RIGHT:  39,
			DOWN:   40
		};

		// bind event handlers
		this.bindHandlers();
	}

	/**
	* Setup initial bindings
	*/
	Menubar.prototype.bindHandlers = function() {

		var that = this;

		this.$items.click(function(event) {
				return	that.handleClick($(this),event);
		});

		this.$items.keydown(function(event) {
			// if key is one of this.keys
			for (var key in that.keys) {
				if (that.keys[key] == event.which) {
					return that.handleKeyDown($(this),event);
				}
			}
		});

		$(document).click(function(event) {
			return that.handleDocumentClick(event);
		});

	};


	/**
	* Handle clicks to document to close menu
	* 
	* @param event {object} associated event
	* @return {boolean} returns true
	*/
	Menubar.prototype.handleDocumentClick = function(event) {
		if (!$(event.target).closest(this.$id).length) {
			this.hideOthers(this.$id.find('[aria-checked=true]'));
		}
		return true;
	};


	/**
	* Click handler
	* 
	* @param elem {object} jQuery object firing event
	* @param event {object} associated event object
	*/
	Menubar.prototype.handleClick = function(elem,event) {

		event.stopPropagation();
		return this.showOwns(elem);
	};


	/**
	* KeyDown handler
	* - for various keyboard interaction
	* 
	* @param elem {object} jQuery object firing event
	* @param event {object} associated event object
	* @return {object} return curernt jQuery element (to focus) 
	*/
	Menubar.prototype.handleKeyDown = function(elem,event) {

		var el = $(elem);
		var closestMenu = el.closest('[role=menu]');

		switch(event.keyCode) {
			case this.keys.TAB:
				// goto next
				return true;
			case this.keys.ENTER:
			case this.keys.SPACE:
				if (closestMenu.hasClass('a-dnav__upcoming')) {	return true; }
				this.$activeItem = this.moveDown(elem,event);
				break;
			case this.keys.DOWN:
				if (closestMenu.hasClass('a-dnav__vert')) {
					this.$activeItem = this.moveRight(elem,event);
				} else {
					this.$activeItem = this.moveDown(elem,event);
				}
				break;
			case this.keys.UP:
				this.$activeItem = this.moveUp(elem,event);
				break;
			case this.keys.RIGHT:
				this.$activeItem = this.moveRight(elem,event);
				break;
			case this.keys.LEFT:
				this.$activeItem = this.moveLeft(elem,event);
				break;
			case this.keys.ESC:
				this.$activeItem = this.moveEscape(elem,event);
				break;
		}

		this.$activeItem.focus();
	};

	Menubar.prototype.moveDown = function (elem,event) {

		var el = $(elem);
		var closestMenu = el.closest('[role=menu]');

		if (closestMenu.hasClass('a-dnav__upcoming')){
			el = closestMenu.next();
		}
		// TODO why can't I refactor?
		else if (closestMenu.hasClass('a-dnav__trims') || el.next().hasClass('a-dnav__content')){
			this.showOwns(elem);
			el = el.next();
			return el;
		}
		else {
			this.showOwns(elem);
			el = el.next();
		}

		el = el.find('[role=menuitem]').first();

		return el;
	};

	Menubar.prototype.moveUp = function (elem,event) {

		var el = $(elem);
		var	closestMenu = el.closest('[role=menu]');

		if (closestMenu.hasClass('a-dnav__upcoming')) {
			el = closestMenu.parent().prev();
		}
		else if (closestMenu.hasClass('a-dnav__models')) {
			el = closestMenu.prev().find('[role=menuitem]').first();
		}
		else if ( el.hasClass('a-dnav__content') ) {
			el = el.prev();
		}		
		else {
			el = closestMenu.prev();
		}

		return el;
	};

	Menubar.prototype.moveRight = function (elem,event) {

		var el = $(elem).parent().next().find('[role=menuitem]').first();
		var selectedItem = this.showOwns(el);

		return selectedItem;
	};

	Menubar.prototype.moveLeft = function (elem,event) {

		var el = $(elem).parent().prev().find('[role=menuitem]').first();
		var	selectedItem = this.showOwns(el);
			
		return selectedItem;
	};

	Menubar.prototype.moveEscape = function (elem,event) {
		
		var el = $(elem);

		if (el.hasClass('a-dnav__content')) {
			el.attr('aria-hidden',true);
		} else {
			this.hideOthers(elem);
		}
		return this.moveUp(elem,event);
	};


	/**
	* Shows children that associated buttons aria-owns
	* - sets aria attributes
	* - also hides other siblings of current button
	* 
	* @param elem {jQuery} jQuery object
	* @return {object} returns jQuery object
	*/
	Menubar.prototype.showOwns = function(elem) {

		var el = $(elem);
		var	owns = el.siblings();

		if (!owns.is(':visible') && !el.is('a')) {
			el.attr({
				'aria-expanded': true,
				'aria-checked' : true
			});
			owns.attr('aria-hidden',false);

		}
		// hide others
		this.hideOthers( el.parent().siblings().find('[role=menuitem]') );

		return el;
	};

	Menubar.prototype.hideOthers = function(elems) {

		$(elems).each(function() {
			$(this).attr({
				'aria-expanded': false,
				'aria-checked' : false
			}).siblings()
				.attr('aria-hidden',true);
		});

	};


</script>		
</body>
</html>