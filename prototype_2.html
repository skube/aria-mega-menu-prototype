<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>Prototype II</title>
<style>
	
	*[role=navigation] [aria-hidden=true] {display: none}

</style>

</head>
<body>
<!-- 
- aria-describedby: reads description after (description provides more information that the user might need)
- aria-labelledby: reads label before (label describes the essence of an object)
- aria-label: reads label before
- aria-owns: Defines an object as a parent of another document element, when the child does not appear directly in the subtree of the owner
- aria-flowto="trucksbtn" (try it?)
- TODO: create nomenclature to handle unique IDs
-->
	<div role="navigation">
		
		<ul role="menubar" id="accessible-div-nav">
			<li role="presentation">

				<button type="button" role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false"  id="carsbtn" aria-owns="cars_upcoming car_models">CARS</button>

				<div role="presentation" aria-hidden="true" class="menu-parent">
					
					<dl role="menu" id="cars_upcoming">
						<dt role="presentation" id="cars_upcoming_label">Upcoming vehicles</dt>
						<dd role="presentation" aria-label="Upcoming vehicles"><a role="menuitem" href="#">2014 Camaro</a></dd>
						<dd role="presentation" aria-describedby="cars_upcoming_label"><a role="menuitem" href="#">2014 Colorado</a></dd>
						<dd role="presentation" aria-describedby="cars_upcoming_label"><a role="menuitem" href="#">2014 Colorado</a></dd>
					</dl>

					<ul role="menu" id="car_models">

						<li role="presentation" id="mdl_01">

							<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false"  id="sparkBtn" aria-owns="veh01_car_trims">Spark</button>

							<dl role="menu" id="veh01_car_trims" aria-hidden="true">
								<dt role="presentation" id="car_trims_desc_01">Select a Model</dt>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="car_trim_01_content">Trim 1</button>

									<div id="car_trim_01_content" aria-hidden="true">
										
										<p>something</p>
										<input type="text" />
										<button type="button">choose</button>
										
									</div>
								</dd>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="car_trim_02_content">Trim 2</button>

									<div id="car_trim_02_content" aria-hidden="true">Content here</div>
								</dd>
								<dd role="presentation" aria-describedby="car_trims_desc_01">
									<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" aria-owns="car_trim_03_content">Trim 2</button>

									<div id="car_trim_03_content" aria-hidden="true">Content here</div>
								</dd>
							</dl>
						</li>

						<li role="presentation" id="mdl_02">
							<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" id="sonicBtn" aria-owns="veh02_content">Sonic</button>

							<div id="veh02_content" aria-hidden="true">asdf</div>
						</li>

					</ul>

				</div>

			</li>
			<li role="presentation">

				<button role="menuitem" aria-haspopup="true" aria-expanded="false" aria-checked="false" id="trucksbtn" aria-owns="trucktrims trucks_upcoming"  aria-controls="trucktrims trucks_upcoming">Trucks</button>


			</li>
		</ul>

	</div>

<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

<script type="text/javascript">
	$(document).ready(function() {
		var menu1 = new Menubar('accessible-div-nav');
	}); // end ready()

	function Menubar (id) {

		// define widget properties
		this.$id = $('#' + id);

		this.$rootItems = this.$id.children('li'); // jQuerry array of all root-level menu items

		this.$items = this.$id.find('[role=menuitem]'); // jQuery array of menu items
		this.$parents = this.$id.find('.menu-parent'); // jQuery array of menu items
		this.$allItems = this.$parents.add(this.$items); // jQuery array of all menu items
		this.$activeItem = null; // jQuery object of the menu item with focus

		this.keys = {
			TAB:    9,
			ENTER:  13,
			ESC:    27,
			SPACE:  32,
			LEFT:   37,
			UP:     38,
			RIGHT:  39,
			DOWN:   40
		};

		// bind event handlers
		this.bindHandlers();
	}

	Menubar.prototype.bindHandlers = function() {

		var $this = this;

		this.$allItems.click(function(event){
			if (event.target.tagName=="BUTTON") {
				return	$this.handleClick($(this),event);
			}
		});

		this.$allItems.keydown(function(event){
			// if key is one of this.keys
			for (var key in $this.keys) {
				if ($this.keys[key] == event.which) {
					return $this.handleKeyDown($(this),event);
				}
			}
		});

	};

	Menubar.prototype.handleClick = function(elem,event){
		event.stopPropagation();
		return this.toggleState(elem);
	};

	Menubar.prototype.handleKeyDown = function(elem,event){
		var $this = $(this);
		switch(event.keyCode) {
			case this.keys.TAB:
				// goto next
				return;
			case this.keys.DOWN:
				return this.moveDown(elem,event);
		}
	};

	Menubar.prototype.moveDown = function (elem,event) {

	};

	Menubar.prototype.toggleState = function(elem){

		var 
			el = $(elem),
			siblings = el.siblings();

		if (siblings.is(':visible')) {
			el.attr({
				'aria-expanded': false,
				'aria-checked' : false
			});
			siblings.attr('aria-hidden',true);
		} else {
			el.attr({
				'aria-expanded': true,
				'aria-checked' : true
			});
			siblings.attr('aria-hidden',false);
		}

		return true;

	};

</script>		
</body>
</html>